# Mtrack: A Dynamic Memory Analysis Tool for C

![Mtrack Banner](https://user-images.githubusercontent.com/12863942/148633337-399a747d-2463-4603-a533-96db2b1a03a1.png)

Mtrack is a dynamic memory analysis tool for C. It helps you detect memory leaks, double frees, and other memory-related bugs. It works by "patching" your code at compile-time, intercepting calls to `malloc`, `free`, `calloc`, and `realloc` to monitor your program's memory usage.

## How It Works

Mtrack uses a compile-time patching mechanism based on C preprocessor macros. When you include `mtrack.h`, it redefines the standard memory allocation functions to its own wrappers. These wrappers call the original functions, but also record every allocation and deallocation, providing a detailed report at the end of your program's execution.

This allows you to debug any C program without modifying its source code.

## Features

*   **Memory Leak Detection:** Mtrack identifies and reports all memory blocks that were allocated but not freed.
*   **Error Detection:** It catches common memory errors like double-freeing a pointer or attempting to free an invalid pointer.
*   **Detailed Reports:** Mtrack provides a comprehensive summary of memory usage, including:
    *   Total memory allocated and freed.
    *   The number of calls to `malloc`, `calloc`, `realloc`, and `free`.
    *   The source file, function name, and line number for each memory operation.
*   **Colored Output:** The tool uses color-coded output for easy identification of errors and leaks.
*   **Seamless Integration:** No complex setup is required. Integration is done at compile-time with a simple `make` command.

## Getting Started

### 1. Build the Mtrack library

First, build the Mtrack shared library:

```bash
make -f makelib
```

This command compiles the Mtrack source files and creates a shared library named `libmtrack1.so` in the `lib/` directory.

### 2. Compile your application with Mtrack

Next, compile your application and link it against the Mtrack library. The provided `makeapp` makefile is designed for this purpose. It uses the `-include` compiler flag to automatically prepend `mtrack1.h` to your source files, effectively "patching" them.

To compile a source file (e.g., `test_files/test0.c`):

```bash
make -f makeapp test_files/test0.c
```

This will create an executable file named `test0` in the `test_files/` directory.

### 3. Run your application

Execute your compiled program:

```bash
./test_files/test0
```

Mtrack will automatically output its memory analysis report to `stderr` upon program termination.

## Example Output

Here is an example of the report generated by Mtrack for a program with a memory leak:

```
=========================================
           MTRACK REPORT
=========================================

[+] Allocation Summary:
  - Malloc calls: 1
  - Calloc calls: 0
  - Realloc calls: 0
  - Total allocated: 10 bytes

[+] Free Summary:
  - Free calls: 0
  - Successful frees: 0
  - Free errors: 0
  - Total freed: 0 bytes

=========================================
           Memory Leaks
=========================================
[LEAK] 0x556b2a4b62a0 (10 bytes) allocated by test_files/test0.c:5 in main

[SUMMARY] Total leaks: 1 allocations, 10 bytes

--- END MTRACK REPORT ---
```


```
